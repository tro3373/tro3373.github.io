<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>nodejs | tac lifelog</title><meta name=keywords content><meta name=description content="code,tech,log .. "><meta name=author content><link rel=canonical href=https://tro3373.github.io/tags/nodejs/><meta name=google-site-verification content="gFn4gbm1K_1qzq7At2Sr1-7AuHC45a6pCmvAdUNeUGY"><link crossorigin=anonymous href=/assets/css/stylesheet.0c4fd3725171366f335155acde6fb3c7b7042cd2fd075bebf5023d9b28a701b2.css integrity="sha256-DE/TclFxNm8zUVWs3m+zx7cELNL9B1vr9QI9myinAbI=" rel="preload stylesheet" as=style><link rel=stylesheet href=/scss/style.min.7b5d7016468d598a3e753e3d0ecf004679e628a19804af57943ee84be5b7770a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/base16/apprentice.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vim.min.js></script>
<script type=text/javascript src=/js/terraform.js></script>
<script type=text/javascript>hljs.registerLanguage("terraform",window.hljsDefineTerraform),hljs.highlightAll()</script><link rel=icon href=https://tro3373.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tro3373.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=32x32 href=https://tro3373.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tro3373.github.io/favicon-32x32.png><link rel=mask-icon href=https://tro3373.github.io/favicon-32x32.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://tro3373.github.io/tags/nodejs/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6962926171897574" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20M4SHCC18"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-20M4SHCC18",{anonymize_ip:!1})}</script><meta property="og:title" content="nodejs"><meta property="og:description" content="code,tech,log .. "><meta property="og:type" content="website"><meta property="og:url" content="https://tro3373.github.io/tags/nodejs/"><meta property="og:image" content="https://tro3373.github.io/favicon.png"><meta property="og:site_name" content="tac lifelog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tro3373.github.io/favicon.png"><meta name=twitter:title content="nodejs"><meta name=twitter:description content="code,tech,log .. "></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tro3373.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://tro3373.github.io/favicon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tro3373.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://tro3373.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://tro3373.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://tro3373.github.io/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://tro3373.github.io/>ホーム</a>&nbsp;»&nbsp;<a href=https://tro3373.github.io/tags/>Tags</a></div><h1>nodejs
<a href=/tags/nodejs/index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2023/2023-12-03-whats-new-in-nodejs-21-summary-and-updates/img_hu963c66e23894dacf381e7cdf38bf314d_1192433_360x0_resize_box_3.png 360w ,https://tro3373.github.io/posts/2023/2023-12-03-whats-new-in-nodejs-21-summary-and-updates/img_hu963c66e23894dacf381e7cdf38bf314d_1192433_480x0_resize_box_3.png 480w ,https://tro3373.github.io/posts/2023/2023-12-03-whats-new-in-nodejs-21-summary-and-updates/img_hu963c66e23894dacf381e7cdf38bf314d_1192433_720x0_resize_box_3.png 720w ,https://tro3373.github.io/posts/2023/2023-12-03-whats-new-in-nodejs-21-summary-and-updates/img.png 1024w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2023/2023-12-03-whats-new-in-nodejs-21-summary-and-updates/img.png alt width=1024 height=1024></figure><header class=entry-header><h2>Node.js 21の新機能</h2></header><div class=entry-content><p>Node.js 21の新機能要約 Node.js v21が安定版としてリリース fetchとWebStreams APIが安定化 組み込みWebSocketクライアントの追加 ESモジュールのサポート強化 パフォーマンスの向上と依存関係の更新 Stable Fetch API Status Fetch APIが安定版に昇格 Node.js v17.5.0で導入、v18.xからv20.xではフラグ不要だが実験的扱いが続く Web Streams API Is Stable WebStreams APIが安定化 Fetch APIの実装はAbortControllerインターフェースとWeb Streams APIに依存 Node.js v15.0.0とv16.5.0で追加され、v21で安定化 A Built-in WebSocket Client Node.jsに組み込みWebSocketクライアントが追加 WHATWGによって標準化されたWebSocket globalの導入 ES Modules Improvements 新しい--experimental-default-typeフラグでESモジュールとCommonJSのデフォルト挙動を変更可能 Test Runner Improvements Node.js v20で安定化したネイティブテストランナーのさらなる強化 グロブ表現による複数のテストファイルマッチングのサポート Module Customization Improvements モジュールカスタマイズの簡素化 globalPreloadフックをregister APIとinitializeフックに置き換え llhttp v9.1.2 Strict Mode Enforcement llhttp v9.1.2で厳格モードがデフォルト設定に コードの信頼性とセキュリティ向上のための変更 Performance Improvements to Key APIs 主要APIのパフォーマンス改善 Streams APIの最適化やレスポンスのuncorking改善など V8 Upgraded to v11....</p></div><footer class=entry-footer><span title='2023-12-03 07:17:09 +0900 +0900'><i class='fa-solid fa-pen'></i> 2023-12-03</span>&nbsp;·&nbsp;<span title='2023-12-03 07:17:29 +0900 +0900'><i class='fa-solid fa-rotate-right'></i> 2023-12-03</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;118 文字</footer><a class=entry-link aria-label="post link to Node.js 21の新機能" href=https://tro3373.github.io/posts/2023/2023-12-03-whats-new-in-nodejs-21-summary-and-updates/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img_hubb8647289ad062e385aed49637c9b3b2_73772_360x0_resize_box_3.png 360w ,https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img_hubb8647289ad062e385aed49637c9b3b2_73772_480x0_resize_box_3.png 480w ,https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img_hubb8647289ad062e385aed49637c9b3b2_73772_720x0_resize_box_3.png 720w ,https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img_hubb8647289ad062e385aed49637c9b3b2_73772_1080x0_resize_box_3.png 1080w ,https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img_hubb8647289ad062e385aed49637c9b3b2_73772_1500x0_resize_box_3.png 1500w ,https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img.png 1600w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/img.png alt width=1600 height=820></figure><header class=entry-header><h2>node.js firebase-admin の multicast 時のレスポンスの配列と、指定したトークンの配列順序は一致する</h2></header><div class=entry-content><p>Firebase Cloud Messagingで firebase-admin - npm 使って Multicastすると、複数のデバイスに対して一度にプッシュ通知を送信することができるけど、 どのTokenが失敗したのかわからないのでは？と思い調べた
So to confirm, the response array from sendMulticast is in the same order as the tokens that were passed in, allowing you to match up the indexes of any errors.
https://stackoverflow.com/questions/70008515/firebase-cloud-messaging-multicast-error-messaging-registration-token-not-regist ここにある通り、 multicast 時のトークン配列と、 応答される BatchResponse の配列順序は一致する らしいので、どのトークンが失敗したのかはわかるみたい</p></div><footer class=entry-footer><span title='2023-03-01 21:25:03 +0900 JST'><i class='fa-solid fa-pen'></i> 2023-03-01</span>&nbsp;·&nbsp;<span title='2023-04-21 19:28:25 +0900 JST'><i class='fa-solid fa-rotate-right'></i> 2023-04-21</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;47 文字</footer><a class=entry-link aria-label="post link to node.js firebase-admin の multicast 時のレスポンスの配列と、指定したトークンの配列順序は一致する" href=https://tro3373.github.io/posts/2023/2023-03-01-firebase-admin-multicast-response-is-same-order-with-specified-tokens/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2023/2023-02-13-register_secret_key_for_firebase_admin_to_secret_manager/img_hu6c9a4e43ac07b2cdad77b605e2ec7b1b_13549_360x0_resize_box_3.png 360w ,https://tro3373.github.io/posts/2023/2023-02-13-register_secret_key_for_firebase_admin_to_secret_manager/img_hu6c9a4e43ac07b2cdad77b605e2ec7b1b_13549_480x0_resize_box_3.png 480w ,https://tro3373.github.io/posts/2023/2023-02-13-register_secret_key_for_firebase_admin_to_secret_manager/img_hu6c9a4e43ac07b2cdad77b605e2ec7b1b_13549_720x0_resize_box_3.png 720w ,https://tro3373.github.io/posts/2023/2023-02-13-register_secret_key_for_firebase_admin_to_secret_manager/img.png 730w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2023/2023-02-13-register_secret_key_for_firebase_admin_to_secret_manager/img.png alt width=730 height=386></figure><header class=entry-header><h2>firebase-admin で使用する秘密鍵を SecretManager に登録する</h2></header><div class=entry-content><p>FCM Push用秘密鍵を SecretManager に登録する FCM 秘密鍵を取得 FireBaseへログイン プロジェクトを選択 プロジェクトの設定 サービスアカウント FireBase Admin SDK > 新しい秘密鍵の生成 FCM 秘密鍵を SecretManager に登録 取得した秘密鍵を ./fcm.json で配置する 以下コマンドで登録 aws secretsmanager put-secret-value --secret-id ${SECRET_ID} --secret-string "$(cat&lt;./fcm.json)" 使う SecretManager を扱い易いようにクラス化する 'use strict'; const { SecretsManagerClient, GetSecretValueCommand } = require('@aws-sdk/client-secrets-manager'); const clazz = class Sm { constructor() { this.client = new SecretsManagerClient({ region: process.env.REGION }); // REGION で環境変数へRegionを設定している前提 } async get(key) { const command = new GetSecretValueCommand({ SecretId: key }); const res = await this....</p></div><footer class=entry-footer><span title='2023-02-13 10:13:37 +0900 JST'><i class='fa-solid fa-pen'></i> 2023-02-13</span>&nbsp;·&nbsp;<span title='2023-04-23 18:20:22 +0900 JST'><i class='fa-solid fa-rotate-right'></i> 2023-04-23</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;170 文字</footer><a class=entry-link aria-label="post link to firebase-admin で使用する秘密鍵を SecretManager に登録する" href=https://tro3373.github.io/posts/2023/2023-02-13-register_secret_key_for_firebase_admin_to_secret_manager/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2022/2022-12-20-nodejs_dayjs_instance_with_iso_format_not_work/img_hu12e49b550bce5977d34e82ff9549741f_12045_360x0_resize_box_3.png 360w ,https://tro3373.github.io/posts/2022/2022-12-20-nodejs_dayjs_instance_with_iso_format_not_work/img.png 460w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2022/2022-12-20-nodejs_dayjs_instance_with_iso_format_not_work/img.png alt width=460 height=460></figure><header class=entry-header><h2>Node.js dayjs フォーマット指定時に意図しない結果になる</h2></header><div class=entry-content><p>customParseFormat 拡張した dayjs で TZ 環境変数 と指定するフォーマットで罠にハマる Z 指定したUTC日付はフォーマットで渡してパースしてもUTC扱いされると思ってた。 フォーマット指定では Z があろうが TZ 環境変数に依存する模様 いやいやいや。。。
フォーマット指定時に意図しない結果になる TZ=UTC dayjs('2022-12-17T11:43:29.277Z', 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]').toDate() // => 2022-12-17T11:43:29.277Z TZ=Asia/Tokyo TZ=Asia/Tokyoの場合は -9 時間されインスタンス化される!!!!!!(いやいやいや！！！)
dayjs('2022-12-17T11:43:29.277Z', 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]').toDate() // => 2022-12-17T02:43:29.277Z フォーマットを指定しなければ問題ない
TZ=UTC dayjs('2022-12-17T11:43:29.277Z').toDate() // => 2022-12-17T11:43:29.277Z TZ=Asia/Tokyo dayjs('2022-12-17T11:43:29.277Z').toDate() // => 2022-12-17T11:43:29.277Z</p></div><footer class=entry-footer><span title='2022-12-20 19:14:14 +0900 JST'><i class='fa-solid fa-pen'></i> 2022-12-20</span>&nbsp;·&nbsp;<span title='2023-04-26 19:15:15 +0900 JST'><i class='fa-solid fa-rotate-right'></i> 2023-04-26</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;42 文字</footer><a class=entry-link aria-label="post link to Node.js dayjs フォーマット指定時に意図しない結果になる" href=https://tro3373.github.io/posts/2022/2022-12-20-nodejs_dayjs_instance_with_iso_format_not_work/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2015/2015-10-08-ghost-burogu-export-huairuwobian-huan-surusukuriputowoshu-ita/nodejs-dark_hu315d82011378ee55f307c15d150a73dc_10577_360x0_resize_box_3.png 360w ,https://tro3373.github.io/posts/2015/2015-10-08-ghost-burogu-export-huairuwobian-huan-surusukuriputowoshu-ita/nodejs-dark_hu315d82011378ee55f307c15d150a73dc_10577_480x0_resize_box_3.png 480w ,https://tro3373.github.io/posts/2015/2015-10-08-ghost-burogu-export-huairuwobian-huan-surusukuriputowoshu-ita/nodejs-dark.png 492w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2015/2015-10-08-ghost-burogu-export-huairuwobian-huan-surusukuriputowoshu-ita/nodejs-dark.png alt width=492 height=365></figure><header class=entry-header><h2>Ghost ブログ Export ファイルを変換するスクリプトを書いた</h2></header><div class=entry-content><p>ブログシステムを Ghost へ乗り換えてみたが、 Publish 日付とブログの日付が合わない、といった事象が発生していた。（ブログ再構築の際に順番をいしきしていなかった為、 publish 日付でソートされると、あまり宜しくない結果になった。） 仕方ない、、、と放置していたが、この度簡単なスクリプトを書いて対応した。 node のインストールに若干手こずったが、まぁ、Javascript、簡単！
概要 Ghost 管理メニューより Export した Jsonファイルを用意する。 今回は、ブログタイトルに、記事日付があったので、それを利用した。 title より取り出した 日付で、 publish_at 項目を更新。 本来の日付でソートできた！！ vim convertMyGhostExport.js var srcPath = "/home/ghost/Desktop/your-domain.ghost.2015-10-07.json"; var dstPath = "/home/ghost/Desktop/your-domain.ghost.2015-10-07_dst.json"; var json = require(srcPath); json.db[0].data.posts.every(function(post,index,ar){ var dateStr = post.title.substr(0, 8); if (!dateStr.match(/\d{8}/)) { // title の頭８文字が数値出ない場合は対象外 return true; } if (post.status != "published") { // 公開していない場合は対象外 return true; } var yyyy = dateStr.substr(0,4); var mm = dateStr.substr(4,2) - 1; var dd = dateStr....</p></div><footer class=entry-footer><span title='2015-10-08 19:24:54 +0900 JST'><i class='fa-solid fa-pen'></i> 2015-10-08</span>&nbsp;·&nbsp;<span title='2023-04-26 19:24:54 +0900 JST'><i class='fa-solid fa-rotate-right'></i> 2023-04-26</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;157 文字</footer><a class=entry-link aria-label="post link to Ghost ブログ Export ファイルを変換するスクリプトを書いた" href=https://tro3373.github.io/posts/2015/2015-10-08-ghost-burogu-export-huairuwobian-huan-surusukuriputowoshu-ita/></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://tro3373.github.io/>tac lifelog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>