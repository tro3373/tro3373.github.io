<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>json on tac lifelog</title>
    <link>https://tro3373.github.io/tags/json/</link>
    <description>Recent content in json on tac lifelog</description>
    <image>
      <title>tac lifelog</title>
      <url>https://tro3373.github.io/favicon.png</url>
      <link>https://tro3373.github.io/favicon.png</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Mon, 27 Oct 2025 16:02:13 +0900</lastBuildDate><atom:link href="https://tro3373.github.io/tags/json/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Go言語omitemptyの罠：falseが保存できない</title>
      <link>https://tro3373.github.io/posts/2025/2025-10-27-go-omitempty-tag-for-json-and-firestore/</link>
      <pubDate>Mon, 27 Oct 2025 16:02:13 +0900</pubDate>
      
      <guid>https://tro3373.github.io/posts/2025/2025-10-27-go-omitempty-tag-for-json-and-firestore/</guid>
      <description>結論：omitemptyは便利だが罠がある omitemptyタグは空値を省略できて便利だが、falseや0が保存できなくなる罠がある。
特にboolean型で**「false」と「未設定」を区別したい場合は要注意**だ。
omitemptyとは 空値の場合にフィールドを省略するタグ。JSON/Firestoreへの保存時にデータサイズを削減できる。
type User struct { Name string `json:&amp;#34;name&amp;#34;` Email string `json:&amp;#34;email,omitempty&amp;#34;` // 空なら省略 } ⚠️ 最大の罠：「空」とみなされる値 以下の値は「空」として扱われ、omitempty付きフィールドから消える:
型 空とみなされる値 保存できない値の例 真偽値 false ❌ falseが保存不可 数値 0 ❌ 0が保存不可 文字列 &amp;quot;&amp;quot; ❌ 空文字列が保存不可 スライス/マップ nil または長さ0 ❌ 空配列が保存不可 ポインタ nil - 時刻 time.Timeのゼロ値 - 実例：boolean型の罠 問題のあるコード type Config struct { EnableFeature bool `firestore:&amp;#34;enableFeature,omitempty&amp;#34;` } config := Config{EnableFeature: false} // ❌ Firestoreに保存されない！ // &amp;#34;enableFeature&amp;#34;フィールド自体が消える これでは「false」と「未設定」が区別できない。
解決策：ポインタ型を使う type Config struct { EnableFeature *bool `firestore:&amp;#34;enableFeature,omitempty&amp;#34;` } // パターン1: 未設定 config := Config{EnableFeature: nil} // → フィールド省略（未設定として扱える） // パターン2: 明示的にfalse falseValue := false config := Config{EnableFeature: &amp;amp;falseValue} // → ✅ falseとして保存される // パターン3: true trueValue := true config := Config{EnableFeature: &amp;amp;trueValue} // → ✅ trueとして保存される 動作比較 omitemptyあり type User struct { Name string `json:&amp;#34;name&amp;#34;` Age int `json:&amp;#34;age,omitempty&amp;#34;` Active bool `json:&amp;#34;active,omitempty&amp;#34;` } user := User{Name: &amp;#34;Alice&amp;#34;, Age: 0, Active: false} // JSON: {&amp;#34;name&amp;#34;:&amp;#34;Alice&amp;#34;} // ❌ Age=0 と Active=false は消える omitemptyなし user := User{Name: &amp;#34;Alice&amp;#34;, Age: 0, Active: false} // JSON: {&amp;#34;name&amp;#34;:&amp;#34;Alice&amp;#34;,&amp;#34;age&amp;#34;:0,&amp;#34;active&amp;#34;:false} // ✅ 0 と false もちゃんと保存される Firestore/JSONでの使い分け データ削減を優先する場合 Email string `json:&amp;#34;email,omitempty&amp;#34;` // 未入力のメールアドレスは保存しなくていい 値の区別が必要な場合 // boolean型: falseと未設定を区別したい IsAdmin *bool `firestore:&amp;#34;isAdmin,omitempty&amp;#34;` // 数値型: 0と未設定を区別したい Score *int `firestore:&amp;#34;score,omitempty&amp;#34;` まとめ omitemptyは空値を省略してデータサイズを削減できる false、0、空文字列は「空」扱いで消える（最大の罠） 値の区別が必要ならポインタ型を使う JSON/Firestoreどちらでも同じ仕組みで動作 Some illustrations on this site, including the Go Gopher, are by Renée French and licensed under CC BY 4.</description>
    </item>
    
  </channel>
</rss>
