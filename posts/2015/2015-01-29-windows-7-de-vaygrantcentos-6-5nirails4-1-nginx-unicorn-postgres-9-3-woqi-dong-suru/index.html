<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する | tac lifelog</title><meta name=keywords content="centos6.5,virtualbox,vagrant"><meta name=description content="Virtual Box インストール Download
本家 Virtualbox より、 Virtual Box ダウンロード
インストール
Vagrant インストール Download
本家 Vagrant より、 Vagrantダウンロード
インストール
再起動が必要
仮想マシン（BOX（テンプレート））取得・追加 CnetOS 6.5 用 URL 取得
Vagrantbox.es より、Virtual Box用、CentOS 6.5 x86_64 URLをコピーする
Box add
cd c:\HashiCorp\Vagrant\ mkdir myhost cd myhost c:\HashiCorp\Vagrant\myhost> vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box ==> box: Adding box 'centos65' (v0) for provider: box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box box: Progress: 100% (Rate: 3348k/s, Estimated time remaining: --:--:--) ==> box: Successfully added box 'centos65' (v0) for 'virtualbox'!"><meta name=author content><link rel=canonical href=https://tro3373.github.io/posts/2015/2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru/><meta name=google-site-verification content="gFn4gbm1K_1qzq7At2Sr1-7AuHC45a6pCmvAdUNeUGY"><link crossorigin=anonymous href=/assets/css/stylesheet.0c4fd3725171366f335155acde6fb3c7b7042cd2fd075bebf5023d9b28a701b2.css integrity="sha256-DE/TclFxNm8zUVWs3m+zx7cELNL9B1vr9QI9myinAbI=" rel="preload stylesheet" as=style><link rel=stylesheet href=/scss/style.min.7b5d7016468d598a3e753e3d0ecf004679e628a19804af57943ee84be5b7770a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/base16/apprentice.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vim.min.js></script>
<script type=text/javascript src=/js/terraform.js></script>
<script type=text/javascript>hljs.registerLanguage("terraform",window.hljsDefineTerraform),hljs.highlightAll()</script><link rel=icon href=https://tro3373.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tro3373.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=32x32 href=https://tro3373.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tro3373.github.io/favicon-32x32.png><link rel=mask-icon href=https://tro3373.github.io/favicon-32x32.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6962926171897574" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20M4SHCC18"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-20M4SHCC18",{anonymize_ip:!1})}</script><meta property="og:title" content="Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する"><meta property="og:description" content="Virtual Box インストール Download
本家 Virtualbox より、 Virtual Box ダウンロード
インストール
Vagrant インストール Download
本家 Vagrant より、 Vagrantダウンロード
インストール
再起動が必要
仮想マシン（BOX（テンプレート））取得・追加 CnetOS 6.5 用 URL 取得
Vagrantbox.es より、Virtual Box用、CentOS 6.5 x86_64 URLをコピーする
Box add
cd c:\HashiCorp\Vagrant\ mkdir myhost cd myhost c:\HashiCorp\Vagrant\myhost> vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box ==> box: Adding box 'centos65' (v0) for provider: box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box box: Progress: 100% (Rate: 3348k/s, Estimated time remaining: --:--:--) ==> box: Successfully added box 'centos65' (v0) for 'virtualbox'!"><meta property="og:type" content="article"><meta property="og:url" content="https://tro3373.github.io/posts/2015/2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru/"><meta property="og:image" content="https://tro3373.github.io/favicon.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-01-29T00:00:00+00:00"><meta property="article:modified_time" content="2015-01-29T00:00:00+00:00"><meta property="og:site_name" content="tac lifelog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tro3373.github.io/favicon.png"><meta name=twitter:title content="Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する"><meta name=twitter:description content="Virtual Box インストール Download
本家 Virtualbox より、 Virtual Box ダウンロード
インストール
Vagrant インストール Download
本家 Vagrant より、 Vagrantダウンロード
インストール
再起動が必要
仮想マシン（BOX（テンプレート））取得・追加 CnetOS 6.5 用 URL 取得
Vagrantbox.es より、Virtual Box用、CentOS 6.5 x86_64 URLをコピーする
Box add
cd c:\HashiCorp\Vagrant\ mkdir myhost cd myhost c:\HashiCorp\Vagrant\myhost> vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box ==> box: Adding box 'centos65' (v0) for provider: box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box box: Progress: 100% (Rate: 3348k/s, Estimated time remaining: --:--:--) ==> box: Successfully added box 'centos65' (v0) for 'virtualbox'!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tro3373.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する","item":"https://tro3373.github.io/posts/2015/2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する","name":"Windows 7 で vaygrant(CentOS 6.5)にRails4.1 \u002b Nginx \u002b Unicorn \u002b Postgres 9.3 を起動する","description":"Virtual Box インストール Download\n本家 Virtualbox より、 Virtual Box ダウンロード\nインストール\nVagrant インストール Download\n本家 Vagrant より、 Vagrantダウンロード\nインストール\n再起動が必要\n仮想マシン（BOX（テンプレート））取得・追加 CnetOS 6.5 用 URL 取得\nVagrantbox.es より、Virtual Box用、CentOS 6.5 x86_64 URLをコピーする\nBox add\ncd c:\\HashiCorp\\Vagrant\\ mkdir myhost cd myhost c:\\HashiCorp\\Vagrant\\myhost\u0026gt; vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box ==\u0026gt; box: Adding box \u0026#39;centos65\u0026#39; (v0) for provider: box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box box: Progress: 100% (Rate: 3348k/s, Estimated time remaining: --:--:--) ==\u0026gt; box: Successfully added box \u0026#39;centos65\u0026#39; (v0) for \u0026#39;virtualbox\u0026#39;!","keywords":["centos6.5","virtualbox","vagrant"],"articleBody":"Virtual Box インストール Download\n本家 Virtualbox より、 Virtual Box ダウンロード\nインストール\nVagrant インストール Download\n本家 Vagrant より、 Vagrantダウンロード\nインストール\n再起動が必要\n仮想マシン（BOX（テンプレート））取得・追加 CnetOS 6.5 用 URL 取得\nVagrantbox.es より、Virtual Box用、CentOS 6.5 x86_64 URLをコピーする\nBox add\ncd c:\\HashiCorp\\Vagrant\\ mkdir myhost cd myhost c:\\HashiCorp\\Vagrant\\myhost\u003e vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box ==\u003e box: Adding box 'centos65' (v0) for provider: box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box box: Progress: 100% (Rate: 3348k/s, Estimated time remaining: --:--:--) ==\u003e box: Successfully added box 'centos65' (v0) for 'virtualbox'! 仮想マシン初期化\nc:\\HashiCorp\\Vagrant\\myhost\u003e vagrant init centos65 ブリッジ設定 c:\\HashiCorp\\Vagrant\\myhost\\vagrantfile を編集する\nconfig.vm.network \"public_network\" # ←アンコメントする 仮想マシン起動 仮想マシン起動 c:\\HashiCorp\\Vagrant\\myhost\u003e vagrant up Bringing machine 'default' up with 'virtualbox' provider... ==\u003e default: Importing base box 'centos65'... ==\u003e default: Matching MAC address for NAT networking... ==\u003e default: Setting the name of the VM: myhost_default_1421716347228_35069 ==\u003e default: Clearing any previously set network interfaces... ==\u003e default: Preparing network interfaces based on configuration... default: Adapter 1: nat ==\u003e default: Forwarding ports... default: 22 =\u003e 2222 (adapter 1) ==\u003e default: Booting VM... ==\u003e default: Waiting for machine to boot. This may take a few minutes... default: SSH address: 127.0.0.1:2222 default: SSH username: vagrant default: SSH auth method: private key default: Warning: Connection timeout. Retrying... default: default: Vagrant insecure key detected. Vagrant will automatically replace default: this with a newly generated keypair for better security. default: default: Inserting generated public key within guest... default: Removing insecure key from the guest if its present... default: Key inserted! Disconnecting and reconnecting using new SSH key... ==\u003e default: Machine booted and ready! ==\u003e default: Checking for guest additions in VM... ==\u003e default: Mounting shared folders... default: /vagrant =\u003e C:/HashiCorp/Vagrant/myhost SSH 接続(TeraTerm で確認) アドレス: 127.0.0.1 ポート: 2222 ユーザ: vagrant パスワード: vagrant 仮想マシン停止 状態確認\nc:\\HashiCorp\\Vagrant\\myhost\u003e vagrant status サスペンド\nc:\\HashiCorp\\Vagrant\\myhost\u003e vagrant suspend 終了（電源ぶちぎり）\nc:\\HashiCorp\\Vagrant\\myhost\u003e vagrant halt 仮想マシン内でシャットダウン(これがベストっぽい)\n$ sudo shutdown -h 00 各種設定 iptables 削除 # 設定削除 $ sudo iptables -F # 確認 $ sudo iptables -nL # OKであれば保存 $ sudo /etc/init.d/iptables save rbenv インストール via anyenv $ git clone https://github.com/riywo/anyenv ~/.anyenv $ echo 'export PATH=\"$HOME/.anyenv/bin:$PATH\"' \u003e\u003e ~/.bash_profile $ echo 'eval \"$(anyenv init -)\"' \u003e\u003e ~/.bash_profile $ exec $SHELL -l $ anyenv install rbenv $ exec $SHELL -l Ruby 2.2.0 インストール # バージョン一覧は $ rbenv install -list # Ruby ビルドで、ビルドエラーが発生するので、 libffi-devel インストール $ sudo yum install -y libffi-devel $ rbenv install -v 2.2.0 $ rbenv global 2.2.0 Rails インストール $ gem update --system $ gem install rails --no-ri --no-rdoc -V # ドキュメントをインストールしない $ rbenv rehash $ rails -v Nginx インストール インストール $ sudo yum install -y nginx 自動起動設定 $ sudo chkconfig --level 35 nginx on MySQL インストール インストール $ sudo yum install -y mysql mysql-server mysql-devel 自動起動設定 $ sudo chkconfig --level 35 mysqld on Postgresql 9.3 インストール $ sudo rpm -i http://yum.postgresql.org/9.3/redhat/rhel-6-x86_64/pgdg-redhat93-9.3-1.noarch.rpm $ sudo yum -y install postgresql93-server postgresql93-contrib postgresql-devel Postgresql設定 $ sudo service postgresql-9.3 initdb # 自動起動設定 $ sudo chkconfig postgresql-9.3 on $ sudo service postgresql-9.3 status $ sudo service postgresql-9.3 start # タイムゾーン設定 $ sudo vim /var/lib/pgsql/9.3/data/postgresql.conf 以下に設定\ntimezone = 'Asia/Tokyo' Postgresユーザ設定\n# 情報確認 $ id postgres # postgres ユーザパスワード設定 $ sudo passwd postgres 'postgres' 2回入力 $ su - postgres -- vagrant ユーザを作成 postgres=# create user vagrant createdb password 'vagrant' login; postgres=# \\q $ exit Rails App 作成 $ cd /path/to/dir $ gem install bundler $ rails new myApp -d postgresql $ cd myApp $ vim Gemfile 以下をコメントイン、追記\ngem 'therubyracer', platforms: :ruby ... # Use unicorn as the app server gem 'unicorn' # readline 追記 gem 'rb-readline' インストール\n$ bundle install --path vendor/bundle bundle install --path vendor/bundle 時、Text file busy @ unlink_internal... なるエラーとなった場合 アプリの格納先が、VMの共有ファイル上となっていないか確認する 共有フォルダ内にある場合に発生するエラー [小ネタ][Ruby on Rails]bundle install時にText file busy エラー データベース設定\n$ vim conifg/database.yml 以下、 utf8 へ変更\ndefault: \u0026default adapter: postgresql encoding: utf8 # utf8 へ変更 username: vagrant # vagrant ユーザを指定 password: vagrant # vagrant ユーザパスを指定 Databse作成\n$ bundle exec rake db:create $ bundle exec rails generate scaffold user password:string mail_address:text ... # などなど、アプリに応じて設定 # db/migrate/ 配下の DB作成処理も合わせて修正 # DB作成 $ bundle exec rake db:migrate # 削除 $ bundle exec rails destroy scaffold user ... # DB作成しなおし $ bundle exec rake db:migrate:reset Unicorn 設定 $ vim conifg/unicorn.rb 設定内容は以下\n@app_path = '/path/to/dir/myApp' worker_processes 2 working_directory \"#{@app_path}/\" # This loads the application in the master process before forking # worker processes # Read more about it here: # http://unicorn.bogomips.org/Unicorn/Configurator.html preload_app true timeout 30 # This is where we specify the socket. # We will point the upstream Nginx module to this socket later on listen \"/tmp/unicorn.sock\", :backlog =\u003e 64 pid \"/tmp/unicorn.pid\" # Set the path of the log files inside the log folder of the testapp stderr_path \"#{@app_path}/log/unicorn.stderr.log\" stdout_path \"#{@app_path}/log/unicorn.stdout.log\" before_fork do |server, worker| defined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect! old_pid = \"#{server.config[:pid]}.oldbin\" if old_pid != server.pid begin sig = (worker.nr + 1) \u003e= server.worker_processes ? :QUIT : :TTOU Process.kill(sig, File.read(old_pid).to_i) rescue Errno::ENOENT, Errno::ESRCH end end sleep 1 end after_fork do |server, worker| defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection end Nginx 設定 $ sudo mv /etc/nginx/conf.d/default.conf ~ $ sudo vim /etc/nginx/conf.d/myapp.conf 設定内容は以下\nupstream unicorn_server { # This is the socket we configured in unicorn.rb server unix:/tmp/unicorn.sock fail_timeout=0; } server { listen 80; client_max_body_size 4G; server_name _; keepalive_timeout 5; # Location of our static files root /path/to/dir/myApp/public; location / { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_redirect off; # If you don't find the filename in the static files # Then request it from the unicorn server if (!-f $request_filename) { proxy_pass http://unicorn_server; break; } } error_page 500 502 503 504 /500.html; location = /500.html { root /path/to/dir/myApp/public; } } $ sudo /etc/init.d/nginx restart Unicorn 起動\n$ bundle exec unicorn_rails -c config/unicorn.rb -E development -D Unicorn 停止\n$ cat /tmp/unicorn.pid | xargs kill # または $ ps ax | grep unicorn | awk '{print $1}' | xargs kill 自動起動設定 $ sudo vim /etc/init.d/unicorn 設定内容は以下\n#!/bin/sh #chkconfig:2345 85 15 #description:unicorn shell NAME=\"Unicorn\" ENV=development ROOT_DIR=\"/home/vagrant/testapp\" #PID=\"${ROOT_DIR}/tmp/pids/unicorn.pid\" PID=\"/tmp/unicorn.pid\" CONF=\"${ROOT_DIR}/config/unicorn.rb\" OPTIONS=\"\" #OPTIONS=\"--path /rails_app\" start() { if [ -e $PID ]; then echo \"$NAME already started\" exit 1 fi echo \"start $NAME\" cd $ROOT_DIR su - vagrant -c \"cd ${ROOT_DIR} \u0026\u0026 bundle exec unicorn_rails -c ${CONF} -E ${ENV} -D ${OPTIONS}\" } stop() { if [ ! -e $PID ]; then echo \"$NAME not started\" exit 1 fi echo \"stop $NAME\" kill -QUIT `cat ${PID}` } force_stop() { if [ ! -e $PID ]; then echo \"$NAME not started\" exit 1 fi echo \"stop $NAME\" kill -INT `cat ${PID}` } reload() { if [ ! -e $PID ]; then echo \"$NAME not started\" start exit 0 fi echo \"reload $NAME\" kill -HUP `cat ${PID}` } restart() { stop sleep 3 start } case \"$1\" in start) start ;; stop) stop ;; force-stop) force_stop ;; reload) reload ;; restart) restart ;; *) echo \"Syntax Error: release [start|stop|force-stop|reload|restart]\" ;; esac 設定反映\n$ sudo chmod 755 /etc/init.d/unicorn $ sudo chkconfig unicorn on 既存の VirtualBox イメージから Box を作成する この時は、いきなり、 vagrat が VM を認識しなくなったので、VirtualBoxを起動して\nイメージ名を確認した。\n下記コマンド、 [Virtual Box Image Name] は その際に確認した名前を指定する\n$ vagrant package --base [Virtual Box Image Name] --output [box_name].box 作成した Box ファイルから、別PCで VM を起動する $ vagrant box add [image_name] [box_name].box $ vagrant box list $ vagrant init [image_name] $ vagrant up SSH Authentication Errorが発生して、vagrant up が終わらない場合\n以下コマンドにて、 autorized_keys に追記する\n$ curl https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub \u003e .ssh/authorized_keys 参考 rails + nginx + unicorn連携 Vagrant(CentOS6.5)にRuby2.1.2 Rails4.1をインストール Vagrant(CentOS6.5)にRails4.1 + Nginx + Unicorn + MySQL環境でRailsを起動する。 WindowsでVagrantの環境構築 rails + nginx + unicorn連携 Windows 7マシンで、VirtualBox+Vagrantを使いUbuntu 14.04を動かす windowsとvagrant間のファイル共有はsambaを使う vagrantにpingが通らなくてハマった話 使用ソフト License unicorn Rails Nginx 連携用 GPLV2,V3 Unicorn is licensed under (your choice) of the GPLv2 or later (GPLv3+ preferred), or Ruby (1.8)-specific terms. See the included LICENSE file for details. rails gem foreigner 外部制約キー導入用 MIT Copyright (c) 2012 Matthew Higgins, released under the MIT License rails gem composite_primary_keys 複合主キー導入用 MIT This code is free to use under the terms of the MIT licence. rails gem rb-readline bundle install error 対応 BSD ","wordCount":"1256","inLanguage":"ja","datePublished":"2015-01-29T00:00:00Z","dateModified":"2015-01-29T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tro3373.github.io/posts/2015/2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru/"},"publisher":{"@type":"Organization","name":"tac lifelog","logo":{"@type":"ImageObject","url":"https://tro3373.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tro3373.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://tro3373.github.io/favicon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tro3373.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://tro3373.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://tro3373.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://tro3373.github.io/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tro3373.github.io/>ホーム</a>&nbsp;»&nbsp;<a href=https://tro3373.github.io/posts/>Posts</a></div><h1 class=post-title>Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する</h1><div class=post-meta><span title='2015-01-29 00:00:00 +0000 UTC'><i class='fa-solid fa-pen'></i> 2015-01-29</span>&nbsp;·&nbsp;<span title='2015-01-29 00:00:00 +0000 UTC'><i class='fa-solid fa-rotate-right'></i> 2015-01-29</span>&nbsp;·&nbsp;6 分&nbsp;·&nbsp;1256 文字</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目次</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#仮想マシンboxテンプレート取得追加>仮想マシン（BOX（テンプレート））取得・追加</a></li><li><a href=#ブリッジ設定>ブリッジ設定</a></li><li><a href=#仮想マシン起動>仮想マシン起動</a></li><li><a href=#ssh-接続teraterm-で確認>SSH 接続(TeraTerm で確認)</a></li><li><a href=#仮想マシン停止>仮想マシン停止</a></li></ul><ul><li><a href=#iptables-削除>iptables 削除</a></li></ul><ul><li><a href=#インストール>インストール</a></li><li><a href=#自動起動設定>自動起動設定</a></li></ul><ul><li><a href=#インストール-1>インストール</a></li><li><a href=#自動起動設定-1>自動起動設定</a></li></ul><ul><li><a href=#インストール-2>インストール</a></li><li><a href=#postgresql設定>Postgresql設定</a></li></ul><ul><li><a href=#既存の-virtualbox-イメージから-box-を作成する>既存の VirtualBox イメージから Box を作成する</a></li><li><a href=#作成した-box-ファイルから別pcで-vm-を起動する>作成した Box ファイルから、別PCで VM を起動する</a></li></ul></nav></div></details></div><div class=post-content><h1 id=virtual-box-インストール>Virtual Box インストール<a hidden class=anchor aria-hidden=true href=#virtual-box-インストール>#</a></h1><ol><li><p>Download</p><p><a class=link href=https://www.virtualbox.org/wiki/Downloads target=_blank rel=noopener>本家 Virtualbox</a>
より、 Virtual Box ダウンロード</p></li><li><p>インストール</p></li></ol><h1 id=vagrant-インストール>Vagrant インストール<a hidden class=anchor aria-hidden=true href=#vagrant-インストール>#</a></h1><ol><li><p>Download</p><p><a class=link href=https://www.vagrantup.com/downloads.html target=_blank rel=noopener>本家 Vagrant</a>
より、 Vagrantダウンロード</p></li><li><p>インストール</p></li><li><p>再起動が必要</p></li></ol><h2 id=仮想マシンboxテンプレート取得追加>仮想マシン（BOX（テンプレート））取得・追加<a hidden class=anchor aria-hidden=true href=#仮想マシンboxテンプレート取得追加>#</a></h2><ol><li><p>CnetOS 6.5 用 URL 取得</p><p><a class=link href=http://www.vagrantbox.es/ target=_blank rel=noopener>Vagrantbox.es</a>
より、Virtual Box用、CentOS 6.5 x86_64 URLをコピーする</p></li><li><p>Box add</p></li></ol><div><div class=codeblock--content><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cd c:\HashiCorp\Vagrant\
</span></span><span class=line><span class=cl>mkdir myhost
</span></span><span class=line><span class=cl>cd myhost
</span></span><span class=line><span class=cl>c:\HashiCorp\Vagrant\myhost&gt; vagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ==&gt; box: Adding box &#39;centos65&#39; (v0) for provider:
</span></span><span class=line><span class=cl>        box: Downloading: https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box
</span></span><span class=line><span class=cl>        box: Progress: 100% (Rate: 3348k/s, Estimated time remaining: --:--:--)
</span></span><span class=line><span class=cl>    ==&gt; box: Successfully added box &#39;centos65&#39; (v0) for &#39;virtualbox&#39;!</span></span></code></pre></div></div></div><ol><li><p>仮想マシン初期化</p><pre><code> c:\HashiCorp\Vagrant\myhost&gt; vagrant init centos65
</code></pre></li></ol><h2 id=ブリッジ設定>ブリッジ設定<a hidden class=anchor aria-hidden=true href=#ブリッジ設定>#</a></h2><p><code>c:\HashiCorp\Vagrant\myhost\vagrantfile</code> を編集する</p><pre><code>config.vm.network &quot;public_network&quot; # ←アンコメントする
</code></pre><h2 id=仮想マシン起動>仮想マシン起動<a hidden class=anchor aria-hidden=true href=#仮想マシン起動>#</a></h2><ol><li>仮想マシン起動</li></ol><div><div class=codeblock--content><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>c:\HashiCorp\Vagrant\myhost&gt; vagrant up
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Bringing machine &#39;default&#39; up with &#39;virtualbox&#39; provider...
</span></span><span class=line><span class=cl>    ==&gt; default: Importing base box &#39;centos65&#39;...
</span></span><span class=line><span class=cl>    ==&gt; default: Matching MAC address for NAT networking...
</span></span><span class=line><span class=cl>    ==&gt; default: Setting the name of the VM: myhost_default_1421716347228_35069
</span></span><span class=line><span class=cl>    ==&gt; default: Clearing any previously set network interfaces...
</span></span><span class=line><span class=cl>    ==&gt; default: Preparing network interfaces based on configuration...
</span></span><span class=line><span class=cl>        default: Adapter 1: nat
</span></span><span class=line><span class=cl>    ==&gt; default: Forwarding ports...
</span></span><span class=line><span class=cl>        default: 22 =&gt; 2222 (adapter 1)
</span></span><span class=line><span class=cl>    ==&gt; default: Booting VM...
</span></span><span class=line><span class=cl>    ==&gt; default: Waiting for machine to boot. This may take a few minutes...
</span></span><span class=line><span class=cl>        default: SSH address: 127.0.0.1:2222
</span></span><span class=line><span class=cl>        default: SSH username: vagrant
</span></span><span class=line><span class=cl>        default: SSH auth method: private key
</span></span><span class=line><span class=cl>        default: Warning: Connection timeout. Retrying...
</span></span><span class=line><span class=cl>        default:
</span></span><span class=line><span class=cl>        default: Vagrant insecure key detected. Vagrant will automatically replace
</span></span><span class=line><span class=cl>        default: this with a newly generated keypair for better security.
</span></span><span class=line><span class=cl>        default:
</span></span><span class=line><span class=cl>        default: Inserting generated public key within guest...
</span></span><span class=line><span class=cl>        default: Removing insecure key from the guest if its present...
</span></span><span class=line><span class=cl>        default: Key inserted! Disconnecting and reconnecting using new SSH key...
</span></span><span class=line><span class=cl>    ==&gt; default: Machine booted and ready!
</span></span><span class=line><span class=cl>    ==&gt; default: Checking for guest additions in VM...
</span></span><span class=line><span class=cl>    ==&gt; default: Mounting shared folders...
</span></span><span class=line><span class=cl>        default: /vagrant =&gt; C:/HashiCorp/Vagrant/myhost</span></span></code></pre></div></div></div><h2 id=ssh-接続teraterm-で確認>SSH 接続(TeraTerm で確認)<a hidden class=anchor aria-hidden=true href=#ssh-接続teraterm-で確認>#</a></h2><ul><li>アドレス: 127.0.0.1</li><li>ポート: 2222</li><li>ユーザ: vagrant</li><li>パスワード: vagrant</li></ul><h2 id=仮想マシン停止>仮想マシン停止<a hidden class=anchor aria-hidden=true href=#仮想マシン停止>#</a></h2><p>状態確認</p><pre><code>c:\HashiCorp\Vagrant\myhost&gt; vagrant status
</code></pre><p>サスペンド</p><pre><code>c:\HashiCorp\Vagrant\myhost&gt; vagrant suspend
</code></pre><p>終了（電源ぶちぎり）</p><pre><code>c:\HashiCorp\Vagrant\myhost&gt; vagrant halt
</code></pre><p>仮想マシン内でシャットダウン(これがベストっぽい)</p><pre><code>$ sudo shutdown -h 00
</code></pre><h1 id=各種設定>各種設定<a hidden class=anchor aria-hidden=true href=#各種設定>#</a></h1><h2 id=iptables-削除>iptables 削除<a hidden class=anchor aria-hidden=true href=#iptables-削除>#</a></h2><pre><code># 設定削除
$ sudo iptables -F
# 確認
$ sudo iptables -nL
# OKであれば保存
$ sudo /etc/init.d/iptables save
</code></pre><h1 id=rbenv-インストール-via-anyenv>rbenv インストール via anyenv<a hidden class=anchor aria-hidden=true href=#rbenv-インストール-via-anyenv>#</a></h1><pre><code>$ git clone https://github.com/riywo/anyenv ~/.anyenv
$ echo 'export PATH=&quot;$HOME/.anyenv/bin:$PATH&quot;' &gt;&gt; ~/.bash_profile
$ echo 'eval &quot;$(anyenv init -)&quot;' &gt;&gt; ~/.bash_profile
$ exec $SHELL -l
$ anyenv install rbenv
$ exec $SHELL -l
</code></pre><h1 id=ruby-220-インストール>Ruby 2.2.0 インストール<a hidden class=anchor aria-hidden=true href=#ruby-220-インストール>#</a></h1><pre><code># バージョン一覧は
$ rbenv install -list
# Ruby ビルドで、ビルドエラーが発生するので、 libffi-devel インストール
$ sudo yum install -y libffi-devel
$ rbenv install -v 2.2.0
$ rbenv global 2.2.0
</code></pre><h1 id=rails-インストール>Rails インストール<a hidden class=anchor aria-hidden=true href=#rails-インストール>#</a></h1><pre><code>$ gem update --system
$ gem install rails --no-ri --no-rdoc -V # ドキュメントをインストールしない
$ rbenv rehash
$ rails -v
</code></pre><h1 id=nginx-インストール>Nginx インストール<a hidden class=anchor aria-hidden=true href=#nginx-インストール>#</a></h1><h2 id=インストール>インストール<a hidden class=anchor aria-hidden=true href=#インストール>#</a></h2><pre><code>$ sudo yum install -y nginx
</code></pre><h2 id=自動起動設定>自動起動設定<a hidden class=anchor aria-hidden=true href=#自動起動設定>#</a></h2><pre><code>$ sudo chkconfig --level 35 nginx on
</code></pre><h1 id=mysql-インストール>MySQL インストール<a hidden class=anchor aria-hidden=true href=#mysql-インストール>#</a></h1><h2 id=インストール-1>インストール<a hidden class=anchor aria-hidden=true href=#インストール-1>#</a></h2><pre><code>$ sudo yum install -y mysql mysql-server mysql-devel
</code></pre><h2 id=自動起動設定-1>自動起動設定<a hidden class=anchor aria-hidden=true href=#自動起動設定-1>#</a></h2><pre><code>$ sudo chkconfig --level 35 mysqld on
</code></pre><h1 id=postgresql-93>Postgresql 9.3<a hidden class=anchor aria-hidden=true href=#postgresql-93>#</a></h1><h2 id=インストール-2>インストール<a hidden class=anchor aria-hidden=true href=#インストール-2>#</a></h2><pre><code>$ sudo rpm -i http://yum.postgresql.org/9.3/redhat/rhel-6-x86_64/pgdg-redhat93-9.3-1.noarch.rpm
$ sudo yum -y install postgresql93-server postgresql93-contrib postgresql-devel
</code></pre><h2 id=postgresql設定>Postgresql設定<a hidden class=anchor aria-hidden=true href=#postgresql設定>#</a></h2><pre><code>$ sudo service postgresql-9.3 initdb
# 自動起動設定
$ sudo chkconfig postgresql-9.3 on
$ sudo service postgresql-9.3 status
$ sudo service postgresql-9.3 start
# タイムゾーン設定
$ sudo vim /var/lib/pgsql/9.3/data/postgresql.conf
</code></pre><p>以下に設定</p><pre><code>timezone = 'Asia/Tokyo'
</code></pre><p>Postgresユーザ設定</p><pre><code># 情報確認
$ id postgres
# postgres ユーザパスワード設定
$ sudo passwd postgres
  'postgres' 2回入力
$ su - postgres
-- vagrant ユーザを作成
postgres=# create user vagrant createdb password 'vagrant' login;
postgres=# \q
$ exit
</code></pre><h1 id=rails-app-作成>Rails App 作成<a hidden class=anchor aria-hidden=true href=#rails-app-作成>#</a></h1><pre><code>$ cd /path/to/dir
$ gem install bundler
$ rails new myApp -d postgresql
$ cd myApp
$ vim Gemfile
</code></pre><p>以下をコメントイン、追記</p><pre><code>gem 'therubyracer', platforms: :ruby

...

# Use unicorn as the app server
gem 'unicorn'

# readline 追記
gem 'rb-readline'
</code></pre><p>インストール</p><pre><code>$ bundle install --path vendor/bundle
</code></pre><ul><li><code>bundle install --path vendor/bundle</code> 時、<code>Text file busy @ unlink_internal...</code> なるエラーとなった場合<ul><li>アプリの格納先が、VMの共有ファイル上となっていないか確認する<ul><li>共有フォルダ内にある場合に発生するエラー</li><li><a class=link href=http://dev.classmethod.jp/server-side/ruby-on-rails/tips_ruby-on-railsbundle-install_text-file-busy-error/ target=_blank rel=noopener>[小ネタ][Ruby on Rails]bundle install時にText file busy エラー</a></li></ul></li></ul></li></ul><p>データベース設定</p><pre><code>$ vim conifg/database.yml
</code></pre><p>以下、 utf8 へ変更</p><pre><code>default: &amp;default
  adapter: postgresql
  encoding: utf8       # utf8 へ変更
  username: vagrant    # vagrant ユーザを指定
  password: vagrant    # vagrant ユーザパスを指定
</code></pre><p>Databse作成</p><pre><code>$ bundle exec rake db:create

$ bundle exec rails generate scaffold user password:string mail_address:text
...

# などなど、アプリに応じて設定
# db/migrate/ 配下の DB作成処理も合わせて修正

# DB作成
$ bundle exec rake db:migrate

# 削除
$ bundle exec rails destroy scaffold user
...

# DB作成しなおし
$ bundle exec rake db:migrate:reset
</code></pre><h1 id=unicorn-設定>Unicorn 設定<a hidden class=anchor aria-hidden=true href=#unicorn-設定>#</a></h1><pre><code>$ vim conifg/unicorn.rb
</code></pre><p>設定内容は以下</p><div><div class=codeblock--content><div class=highlight><pre tabindex=0 class=chroma><code class=language-v data-lang=v><span class=line><span class=cl><span class=o>@</span><span class=nv>app_path</span> <span class=o>=</span> <span class=s1>&#39;/path/to/dir/myApp&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>worker_processes</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=nv>working_directory</span> <span class=s2>&#34;#{@app_path}/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nc>This</span> <span class=nv>loads</span> <span class=nv>the</span> <span class=nv>application</span> <span class=k>in</span> <span class=nv>the</span> <span class=nv>master</span> <span class=nv>process</span> <span class=nv>before</span> <span class=nv>forking</span>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nv>worker</span> <span class=nv>processes</span>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nc>Read</span> <span class=nv>more</span> <span class=nv>about</span> <span class=vm>it</span> <span class=nl>here</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nv>http</span><span class=p>:</span><span class=c1>//unicorn.bogomips.org/Unicorn/Configurator.html
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>preload_app</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>timeout</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nc>This</span> <span class=k>is</span> <span class=nv>where</span> <span class=nv>we</span> <span class=nv>specify</span> <span class=nv>the</span> <span class=nv>socket</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nc>We</span> <span class=nv>will</span> <span class=nv>point</span> <span class=nv>the</span> <span class=nv>upstream</span> <span class=nc>Nginx</span> <span class=kn>module</span> <span class=nv>to</span> <span class=nv>this</span> <span class=nv>socket</span> <span class=nv>later</span> <span class=nv>on</span>
</span></span><span class=line><span class=cl><span class=nv>listen</span> <span class=s2>&#34;/tmp/unicorn.sock&#34;</span><span class=p>,</span> <span class=p>:</span><span class=nv>backlog</span> <span class=o>=</span><span class=p>&gt;</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>pid</span> <span class=s2>&#34;/tmp/unicorn.pid&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>#</span> <span class=nc>Set</span> <span class=nv>the</span> <span class=nv>path</span> <span class=nv>of</span> <span class=nv>the</span> <span class=nv>log</span> <span class=nv>files</span> <span class=nv>inside</span> <span class=nv>the</span> <span class=nv>log</span> <span class=nv>folder</span> <span class=nv>of</span> <span class=nv>the</span> <span class=nv>testapp</span>
</span></span><span class=line><span class=cl><span class=nv>stderr_path</span> <span class=s2>&#34;#{@app_path}/log/unicorn.stderr.log&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>stdout_path</span> <span class=s2>&#34;#{@app_path}/log/unicorn.stdout.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>before_fork</span> <span class=nv>do</span> <span class=o>|</span><span class=nv>server</span><span class=p>,</span> <span class=nv>worker</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=nv>defined</span><span class=kd>?</span><span class=p>(</span><span class=nc>ActiveRecord</span><span class=p>::</span><span class=nc>Base</span><span class=p>)</span> <span class=nv>and</span> <span class=nc>ActiveRecord</span><span class=p>::</span><span class=nc>Base</span><span class=p>.</span><span class=nv>connection</span><span class=p>.</span><span class=nv>disconnect</span><span class=o>!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>old_pid</span> <span class=o>=</span> <span class=s2>&#34;#{server.config[:pid]}.oldbin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nv>old_pid</span> <span class=o>!=</span> <span class=nv>server</span><span class=p>.</span><span class=nv>pid</span>
</span></span><span class=line><span class=cl>      <span class=nv>begin</span>
</span></span><span class=line><span class=cl>        <span class=nv>sig</span> <span class=o>=</span> <span class=p>(</span><span class=nv>worker</span><span class=p>.</span><span class=nv>nr</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=nv>server</span><span class=p>.</span><span class=nv>worker_processes</span> <span class=kd>?</span> <span class=p>:</span><span class=nc>QUIT</span> <span class=p>:</span> <span class=p>:</span><span class=nc>TTOU</span>
</span></span><span class=line><span class=cl>        <span class=nc>Process</span><span class=p>.</span><span class=nf>kill</span><span class=p>(</span><span class=nv>sig</span><span class=p>,</span> <span class=nc>File</span><span class=p>.</span><span class=nf>read</span><span class=p>(</span><span class=nv>old_pid</span><span class=p>).</span><span class=nv>to_i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nv>rescue</span> <span class=nc>Errno</span><span class=p>::</span><span class=nc>ENOENT</span><span class=p>,</span> <span class=nc>Errno</span><span class=p>::</span><span class=nc>ESRCH</span>
</span></span><span class=line><span class=cl>      <span class=nv>end</span>
</span></span><span class=line><span class=cl>    <span class=nv>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>sleep</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nv>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>after_fork</span> <span class=nv>do</span> <span class=o>|</span><span class=nv>server</span><span class=p>,</span> <span class=nv>worker</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=nv>defined</span><span class=kd>?</span><span class=p>(</span><span class=nc>ActiveRecord</span><span class=p>::</span><span class=nc>Base</span><span class=p>)</span> <span class=nv>and</span> <span class=nc>ActiveRecord</span><span class=p>::</span><span class=nc>Base</span><span class=p>.</span><span class=nv>establish_connection</span>
</span></span><span class=line><span class=cl><span class=nv>end</span></span></span></code></pre></div></div></div><h1 id=nginx-設定>Nginx 設定<a hidden class=anchor aria-hidden=true href=#nginx-設定>#</a></h1><pre><code>$ sudo mv /etc/nginx/conf.d/default.conf ~
$ sudo vim /etc/nginx/conf.d/myapp.conf
</code></pre><p>設定内容は以下</p><div><div class=codeblock--content><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>upstream unicorn_server {
</span></span><span class=line><span class=cl>    # This is the socket we configured in unicorn.rb
</span></span><span class=line><span class=cl>    server unix:/tmp/unicorn.sock
</span></span><span class=line><span class=cl>    fail_timeout=0;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>server {
</span></span><span class=line><span class=cl>    listen 80;
</span></span><span class=line><span class=cl>    client_max_body_size 4G;
</span></span><span class=line><span class=cl>    server_name _;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    keepalive_timeout 5;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # Location of our static files
</span></span><span class=line><span class=cl>    root /path/to/dir/myApp/public;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    location / {
</span></span><span class=line><span class=cl>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span class=line><span class=cl>        proxy_set_header Host $http_host;
</span></span><span class=line><span class=cl>        proxy_redirect off;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # If you don&#39;t find the filename in the static files
</span></span><span class=line><span class=cl>        # Then request it from the unicorn server
</span></span><span class=line><span class=cl>        if (!-f $request_filename) {
</span></span><span class=line><span class=cl>            proxy_pass http://unicorn_server;
</span></span><span class=line><span class=cl>            break;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    error_page 500 502 503 504 /500.html;
</span></span><span class=line><span class=cl>    location = /500.html {
</span></span><span class=line><span class=cl>        root /path/to/dir/myApp/public;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}</span></span></code></pre></div></div></div><pre><code>$ sudo /etc/init.d/nginx restart
</code></pre><p>Unicorn 起動</p><pre><code>$ bundle exec unicorn_rails -c config/unicorn.rb -E development -D
</code></pre><p>Unicorn 停止</p><pre><code>$ cat /tmp/unicorn.pid | xargs kill
# または
$ ps ax | grep unicorn | awk '{print $1}' | xargs kill
</code></pre><h1 id=自動起動設定-2>自動起動設定<a hidden class=anchor aria-hidden=true href=#自動起動設定-2>#</a></h1><pre><code>$ sudo vim /etc/init.d/unicorn
</code></pre><p>設定内容は以下</p><div><div class=codeblock--content><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>#chkconfig:2345 85 15</span>
</span></span><span class=line><span class=cl><span class=c1>#description:unicorn shell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>NAME</span><span class=o>=</span><span class=s2>&#34;Unicorn&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ENV</span><span class=o>=</span>development
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ROOT_DIR</span><span class=o>=</span><span class=s2>&#34;/home/vagrant/testapp&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#PID=&#34;${ROOT_DIR}/tmp/pids/unicorn.pid&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PID</span><span class=o>=</span><span class=s2>&#34;/tmp/unicorn.pid&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CONF</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>ROOT_DIR</span><span class=si>}</span><span class=s2>/config/unicorn.rb&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>OPTIONS</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#OPTIONS=&#34;--path /rails_app&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>start<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> -e <span class=nv>$PID</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$NAME</span><span class=s2> already started&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;start </span><span class=nv>$NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>cd</span> <span class=nv>$ROOT_DIR</span>
</span></span><span class=line><span class=cl>  su - vagrant -c <span class=s2>&#34;cd </span><span class=si>${</span><span class=nv>ROOT_DIR</span><span class=si>}</span><span class=s2> &amp;&amp; bundle exec unicorn_rails -c </span><span class=si>${</span><span class=nv>CONF</span><span class=si>}</span><span class=s2> -E </span><span class=si>${</span><span class=nv>ENV</span><span class=si>}</span><span class=s2> -D </span><span class=si>${</span><span class=nv>OPTIONS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>stop<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> ! -e <span class=nv>$PID</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$NAME</span><span class=s2> not started&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;stop </span><span class=nv>$NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>kill</span> -QUIT <span class=sb>`</span>cat <span class=si>${</span><span class=nv>PID</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>force_stop<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> ! -e <span class=nv>$PID</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$NAME</span><span class=s2> not started&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;stop </span><span class=nv>$NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>kill</span> -INT <span class=sb>`</span>cat <span class=si>${</span><span class=nv>PID</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>reload<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> ! -e <span class=nv>$PID</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$NAME</span><span class=s2> not started&#34;</span>
</span></span><span class=line><span class=cl>    start
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;reload </span><span class=nv>$NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>kill</span> -HUP <span class=sb>`</span>cat <span class=si>${</span><span class=nv>PID</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>restart<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    stop
</span></span><span class=line><span class=cl>    sleep <span class=m>3</span>
</span></span><span class=line><span class=cl>    start
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>  start<span class=o>)</span>
</span></span><span class=line><span class=cl>    start
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  stop<span class=o>)</span>
</span></span><span class=line><span class=cl>    stop
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  force-stop<span class=o>)</span>
</span></span><span class=line><span class=cl>    force_stop
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  reload<span class=o>)</span>
</span></span><span class=line><span class=cl>    reload
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  restart<span class=o>)</span>
</span></span><span class=line><span class=cl>    restart
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  *<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Syntax Error: release [start|stop|force-stop|reload|restart]&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span></span></span></code></pre></div></div></div><p>設定反映</p><pre><code>$ sudo chmod 755 /etc/init.d/unicorn
$ sudo chkconfig unicorn on
</code></pre><h2 id=既存の-virtualbox-イメージから-box-を作成する>既存の VirtualBox イメージから Box を作成する<a hidden class=anchor aria-hidden=true href=#既存の-virtualbox-イメージから-box-を作成する>#</a></h2><p>この時は、いきなり、 vagrat が VM を認識しなくなったので、VirtualBoxを起動して<br>イメージ名を確認した。<br>下記コマンド、 <code>[Virtual Box Image Name]</code> は その際に確認した名前を指定する</p><pre><code>$ vagrant package --base [Virtual Box Image Name] --output [box_name].box
</code></pre><h2 id=作成した-box-ファイルから別pcで-vm-を起動する>作成した Box ファイルから、別PCで VM を起動する<a hidden class=anchor aria-hidden=true href=#作成した-box-ファイルから別pcで-vm-を起動する>#</a></h2><pre><code>$ vagrant box add [image_name] [box_name].box
$ vagrant box list
$ vagrant init [image_name]
$ vagrant up
</code></pre><p>SSH Authentication Errorが発生して、<code>vagrant up</code> が終わらない場合<br>以下コマンドにて、 <code>autorized_keys</code> に追記する</p><pre><code>$ curl https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub &gt; .ssh/authorized_keys
</code></pre><h1 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h1><ul><li><a class=link href=http://qiita.com/shinyashikis@github/items/ace49154f0c71c65b2c9 target=_blank rel=noopener>rails + nginx + unicorn連携</a></li><li><a class=link href=http://qiita.com/teitei_tk/items/27ae7b7e73791930929d target=_blank rel=noopener>Vagrant(CentOS6.5)にRuby2.1.2 Rails4.1をインストール</a></li><li><a class=link href=http://qiita.com/teitei_tk/items/74794983d9893c3e7a05 target=_blank rel=noopener>Vagrant(CentOS6.5)にRails4.1 + Nginx + Unicorn + MySQL環境でRailsを起動する。</a></li><li><a class=link href=http://qiita.com/yoh-nak/items/95c735764f38c37ea16a target=_blank rel=noopener>WindowsでVagrantの環境構築</a></li><li><a class=link href=http://qiita.com/shinyashikis@github/items/ace49154f0c71c65b2c9 target=_blank rel=noopener>rails + nginx + unicorn連携</a></li><li><a class=link href=http://blog.kondoyoshiyuki.com/2014/06/12/windows7-vagrant-ubuntu14-04/ target=_blank rel=noopener>Windows 7マシンで、VirtualBox+Vagrantを使いUbuntu 14.04を動かす</a></li><li><a class=link href=http://taropohci.blogspot.jp/2014/03/windowsvagrantsamba.html target=_blank rel=noopener>windowsとvagrant間のファイル共有はsambaを使う</a></li><li><a class=link href=http://sui.hateblo.jp/entry/2013/10/25/005752 target=_blank rel=noopener>vagrantにpingが通らなくてハマった話</a></li></ul><h1 id=使用ソフト-license>使用ソフト License<a hidden class=anchor aria-hidden=true href=#使用ソフト-license>#</a></h1><ul><li>unicorn<ul><li>Rails Nginx 連携用</li><li><a class=link href=http://unicorn.bogomips.org/ target=_blank rel=noopener>GPLV2,V3</a><ul><li>Unicorn is licensed under (your choice) of the GPLv2 or later (GPLv3+ preferred), or Ruby (1.8)-specific terms. See the included LICENSE file for details.</li></ul></li></ul></li><li>rails gem foreigner<ul><li>外部制約キー導入用</li><li><a class=link href=https://github.com/matthuhiggins/foreigner target=_blank rel=noopener>MIT</a><ul><li>Copyright (c) 2012 Matthew Higgins, released under the MIT License</li></ul></li></ul></li><li>rails gem composite_primary_keys<ul><li>複合主キー導入用</li><li><a class=link href=https://github.com/composite-primary-keys/composite_primary_keys/wiki target=_blank rel=noopener>MIT</a><ul><li>This code is free to use under the terms of the MIT licence.</li></ul></li></ul></li><li>rails gem rb-readline
bundle install error 対応<ul><li><a class=link href=https://github.com/ConnorAtherton/rb-readline/blob/master/LICENSE target=_blank rel=noopener>BSD</a></li></ul></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://tro3373.github.io/tags/centos6.5/>centos6.5</a></li><li><a href=https://tro3373.github.io/tags/virtualbox/>virtualbox</a></li><li><a href=https://tro3373.github.io/tags/vagrant/>vagrant</a></li></ul><nav class=paginav><a class=prev href=https://tro3373.github.io/posts/2015/2015-06-05-atomedeitawoppadeinsutorusuru/><span class=title>« 前へ</span><br><span>Ubuntu14.04 AtomエディタをPPAでインストールする</span></a>
<a class=next href=https://tro3373.github.io/posts/2015/2015-01-29-windows7-netutowakushe-ding-wobiao-zhun-deshi-yong-surutoikenairasii/><span class=title>次へ »</span><br><span>Windows7 ネットワーク設定を標準で使用するといけないらしい</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on twitter" href="https://twitter.com/intent/tweet/?text=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b&amp;url=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f&amp;hashtags=centos6.5%2cvirtualbox%2cvagrant"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f&amp;title=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b&amp;summary=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b&amp;source=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f&title=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on whatsapp" href="https://api.whatsapp.com/send?text=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b%20-%20https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on telegram" href="https://telegram.me/share/url?text=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b&amp;url=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Windows 7 で vaygrant(CentOS 6.5)にRails4.1 + Nginx + Unicorn + Postgres 9.3 を起動する on ycombinator" href="https://news.ycombinator.com/submitlink?t=Windows%207%20%e3%81%a7%20vaygrant%28CentOS%206.5%29%e3%81%abRails4.1%20%2b%20Nginx%20%2b%20Unicorn%20%2b%20Postgres%209.3%20%e3%82%92%e8%b5%b7%e5%8b%95%e3%81%99%e3%82%8b&u=https%3a%2f%2ftro3373.github.io%2fposts%2f2015%2f2015-01-29-windows-7-de-vaygrantcentos-6-5nirails4-1-nginx-unicorn-postgres-9-3-woqi-dong-suru%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//jokrlzy.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2026 <a href=https://tro3373.github.io/>tac lifelog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="コピー";function s(){t.innerHTML="コピーされました!",setTimeout(()=>{t.innerHTML="コピー"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>