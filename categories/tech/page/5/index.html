<!doctype html><html lang=ja dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>tech | tac lifelog</title><meta name=keywords content><meta name=description content="code,tech,log .. "><meta name=author content><link rel=canonical href=https://tro3373.github.io/categories/tech/><meta name=google-site-verification content="gFn4gbm1K_1qzq7At2Sr1-7AuHC45a6pCmvAdUNeUGY"><link crossorigin=anonymous href=/assets/css/stylesheet.0c4fd3725171366f335155acde6fb3c7b7042cd2fd075bebf5023d9b28a701b2.css integrity="sha256-DE/TclFxNm8zUVWs3m+zx7cELNL9B1vr9QI9myinAbI=" rel="preload stylesheet" as=style><link rel=stylesheet href=/scss/style.min.7b5d7016468d598a3e753e3d0ecf004679e628a19804af57943ee84be5b7770a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/base16/apprentice.min.css><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/vim.min.js></script>
<script type=text/javascript src=/js/terraform.js></script>
<script type=text/javascript>hljs.registerLanguage("terraform",window.hljsDefineTerraform),hljs.highlightAll()</script><link rel=icon href=https://tro3373.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tro3373.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=32x32 href=https://tro3373.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tro3373.github.io/favicon-32x32.png><link rel=mask-icon href=https://tro3373.github.io/favicon-32x32.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://tro3373.github.io/categories/tech/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6962926171897574" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-20M4SHCC18"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-20M4SHCC18",{anonymize_ip:!1})}</script><meta property="og:title" content="tech"><meta property="og:description" content="code,tech,log .. "><meta property="og:type" content="website"><meta property="og:url" content="https://tro3373.github.io/categories/tech/"><meta property="og:image" content="https://tro3373.github.io/favicon.png"><meta property="og:site_name" content="tac lifelog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tro3373.github.io/favicon.png"><meta name=twitter:title content="tech"><meta name=twitter:description content="code,tech,log .. "></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tro3373.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://tro3373.github.io/favicon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tro3373.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://tro3373.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://tro3373.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://tro3373.github.io/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://tro3373.github.io/>ホーム</a>&nbsp;»&nbsp;<a href=https://tro3373.github.io/categories/>Categories</a></div><h1>tech
<a href=/categories/tech/index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/img_hu4d8030df576b449d3281f073402458c3_24714_360x0_resize_q75_h2_box_2.webp 360w ,https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/img_hu4d8030df576b449d3281f073402458c3_24714_480x0_resize_q75_h2_box_2.webp 480w ,https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/img_hu4d8030df576b449d3281f073402458c3_24714_720x0_resize_q75_h2_box_2.webp 720w ,https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/img_hu4d8030df576b449d3281f073402458c3_24714_1080x0_resize_q75_h2_box_2.webp 1080w ,https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/img.webp 1400w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/img.webp alt width=1400 height=602></figure><header class=entry-header><h2>Alembic revision --autogenerate で変更がなくても空のrevisionファイルができるのを避ける</h2></header><div class=entry-content><p>はじめに Alembic revision –autogenerate で変更がなくても空のrevisionファイルができるのを避ける python 3.11, alembic 1.7.7, sqlalchemy 2.0.30, sqlmodel 0.0.18 問題 疑問 変更がなくても空のrevisionファイルが生成されてしまう
まとめ 結果 解決方法 以下のような process_revision_directives を設定することで、差分がない場合は空のrevisionファイルを生成しない def run_migrations_online(): : def process_revision_directives(context, revision, directives): if config.cmd_opts.autogenerate: script = directives[0] if script.upgrade_ops.is_empty(): directives[:] = [] print('No changes in schema detected.') : with connectable.connect() as connection: context.configure( connection=connection, target_metadata=target_metadata, include_schemas=True, dialect_opts={"paramstyle": "named"}, include_name=include_name, process_revision_directives=process_revision_directives, ) Refs python - How to prevent alembic revision –autogenerate from making revision file if it has not detected any changes?...</p></div><footer class=entry-footer><span title='2024-07-04 11:41:33 +0900 +0900'><i class='fa-solid fa-pen'></i> 2024-07-04</span>&nbsp;·&nbsp;<span title='2024-08-02 06:43:13 +0900 +0900'><i class='fa-solid fa-rotate-right'></i> 2024-08-02</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;81 文字</footer><a class=entry-link aria-label="post link to Alembic revision --autogenerate で変更がなくても空のrevisionファイルができるのを避ける" href=https://tro3373.github.io/posts/2024/2024-07-04-prevent-empty-revision-in-alembic-revision-autogenerate/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/img_hu933213f117fd4441d4044db12b987abc_34714_360x0_resize_q75_h2_box_2.webp 360w ,https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/img_hu933213f117fd4441d4044db12b987abc_34714_480x0_resize_q75_h2_box_2.webp 480w ,https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/img_hu933213f117fd4441d4044db12b987abc_34714_720x0_resize_q75_h2_box_2.webp 720w ,https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/img_hu933213f117fd4441d4044db12b987abc_34714_1080x0_resize_q75_h2_box_2.webp 1080w ,https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/img.webp 1096w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/img.webp alt width=1096 height=974></figure><header class=entry-header><h2>Alembic revision --autogenerate で差分のマイグレーションファイルができない</h2></header><div class=entry-content><p>はじめに Alembic revision –autogenerate で差分のマイグレーションファイルができない python 3.11, alembic 1.7.7, sqlalchemy 2.0.30, sqlmodel 0.0.18 問題 毎回テーブル作成のマイグレーションファイルが生成されてしまう
解決方法 以下のような include_name を設定することで、デフォルトスキーマに限定する
connection は schema 指定でアクセスしている為、type_=schema で name=None で検出される # exclude system table def include_name(name, type_, parent_names): if type_ == "schema": return name in [None] else: return True def run_migrations_online(): : with connectable.connect() as connection: context.configure( connection=connection, target_metadata=target_metadata, dialect_opts={"paramstyle": "named"}, include_schemas=True, include_name=include_name, ) Refs python - Alembic revision –autogenerate always detects a new table, instead of detecting new columns - Stack Overflow</p></div><footer class=entry-footer><span title='2024-07-04 11:33:14 +0900 +0900'><i class='fa-solid fa-pen'></i> 2024-07-04</span>&nbsp;·&nbsp;<span title='2024-08-02 06:50:18 +0900 +0900'><i class='fa-solid fa-rotate-right'></i> 2024-08-02</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;79 文字</footer><a class=entry-link aria-label="post link to Alembic revision --autogenerate で差分のマイグレーションファイルができない" href=https://tro3373.github.io/posts/2024/2024-07-04-alembic-revision-autogenerate-always-generate-new-table/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2024/2024-06-24-sftp-hung-12-minutes/img_hu3bf5f558f6b1dbaf53a55f7d677cff6d_15062_360x0_resize_q75_h2_box_2.webp 360w ,https://tro3373.github.io/posts/2024/2024-06-24-sftp-hung-12-minutes/img_hu3bf5f558f6b1dbaf53a55f7d677cff6d_15062_480x0_resize_q75_h2_box_2.webp 480w ,https://tro3373.github.io/posts/2024/2024-06-24-sftp-hung-12-minutes/img_hu3bf5f558f6b1dbaf53a55f7d677cff6d_15062_720x0_resize_q75_h2_box_2.webp 720w ,https://tro3373.github.io/posts/2024/2024-06-24-sftp-hung-12-minutes/img.webp 888w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2024/2024-06-24-sftp-hung-12-minutes/img.webp alt width=888 height=244></figure><header class=entry-header><h2>atmoz/sftp コンテナにログインするとハングする問題を解決する</h2></header><div class=entry-content><p>問題 atmoz/sftp イメージを使用して、SFTPサーバを立ち上げた際に、
ログインすると長い間ハングして、放置していたらログインできていた、という事象が発生した 開発者間で、同じ問題が発生していた 考察 色々ググった結果、下記記事にたどり着いた
linux - Excessive SFTP CPU usage with chroot enabled when using the official Docker repository - Unix & Linux Stack Exchange Debugging a 12 minute hang after SFTP login どうも コンテナで使用する system の リソース制限の問題のようだったので、
ulimits を設定することで解決した
解決方法 ulimits を設定する
ulimits: nproc: 65535 nofile: soft: 26677 hard: 46677 docker compose の sftp コンテナの全体はこんな感じ
sftp: platform: linux/x86_64 container_name: $app-sftp image: atmoz/sftp init: true ulimits: nproc: 65535 nofile: soft: 26677 hard: 46677 volumes: - ....</p></div><footer class=entry-footer><span title='2024-06-24 19:34:12 +0900 +0900'><i class='fa-solid fa-pen'></i> 2024-06-24</span>&nbsp;·&nbsp;<span title='2024-08-02 07:02:36 +0900 +0900'><i class='fa-solid fa-rotate-right'></i> 2024-08-02</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;110 文字</footer><a class=entry-link aria-label="post link to atmoz/sftp コンテナにログインするとハングする問題を解決する" href=https://tro3373.github.io/posts/2024/2024-06-24-sftp-hung-12-minutes/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img_hu08770832fda13ce4503a10f129a724d8_29566_360x0_resize_q75_h2_box_2.webp 360w ,https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img_hu08770832fda13ce4503a10f129a724d8_29566_480x0_resize_q75_h2_box_2.webp 480w ,https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img_hu08770832fda13ce4503a10f129a724d8_29566_720x0_resize_q75_h2_box_2.webp 720w ,https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img_hu08770832fda13ce4503a10f129a724d8_29566_1080x0_resize_q75_h2_box_2.webp 1080w ,https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img_hu08770832fda13ce4503a10f129a724d8_29566_1500x0_resize_q75_h2_box_2.webp 1500w ,https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img.webp 1586w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/img.webp alt width=1586 height=788></figure><header class=entry-header><h2>VSCode Remote Container で Hung する問題を解決する</h2></header><div class=entry-content><p>はじめに VSCode の リモートコンテナ や dev container を使って開発したいときに、遭遇したエラーの対処法を少し
問題 疑問 リモートSSH機能で VSCode 開くと、terminal でHungする リモートコンテナにアタッチしたり、dev container を開くと、リモートを開いています から進まない どちらも、M1 Mac上で OrbStack 上で立ち上げた ArchLinux に接続しているときに発生した
まとめ 結果 解決方法 VSCode から開く Terminal では Tmux は起動しない
以下設定で、VSCode から起動されているかどうかを判定し、Tmux を起動するかどうかを切り替える
is_vscode() { [[ -n $VSCODE_INJECTION ]]; } 拡張機能のシグニチャ検証を無効化、もしくは、ローカルから拡張機能をインストールする設定を有効にする
dev container の場合は、拡張機能のシグニチャ検証を無効化
{ // Configure tool-specific properties. "customizations": { "vscode": { "settings": { // Workaround for x86_64 containers on aarch64(like M1 Mac) hosts // see: https://zenn....</p></div><footer class=entry-footer><span title='2024-05-23 18:12:47 +0900 +0900'><i class='fa-solid fa-pen'></i> 2024-05-23</span>&nbsp;·&nbsp;<span title='2024-08-02 06:37:14 +0900 +0900'><i class='fa-solid fa-rotate-right'></i> 2024-08-02</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;141 文字</footer><a class=entry-link aria-label="post link to VSCode Remote Container で Hung する問題を解決する" href=https://tro3373.github.io/posts/2024/2024-05-23-use-dev-container-in-orbstack-on-m1-mac/></a></article><article class="post-entry tag-entry"><figure class=entry-cover><img loading=lazy srcset="https://tro3373.github.io/posts/2024/2024-04-25-switch_environment_files_in_build_process_for_cordova/img_hu61a68a85c54cdbee3464f60572d06b1f_193340_360x0_resize_q75_h2_box_2.webp 360w ,https://tro3373.github.io/posts/2024/2024-04-25-switch_environment_files_in_build_process_for_cordova/img_hu61a68a85c54cdbee3464f60572d06b1f_193340_480x0_resize_q75_h2_box_2.webp 480w ,https://tro3373.github.io/posts/2024/2024-04-25-switch_environment_files_in_build_process_for_cordova/img_hu61a68a85c54cdbee3464f60572d06b1f_193340_720x0_resize_q75_h2_box_2.webp 720w ,https://tro3373.github.io/posts/2024/2024-04-25-switch_environment_files_in_build_process_for_cordova/img.webp 1024w" sizes="(min-width: 768px) 720px, 100vw" src=https://tro3373.github.io/posts/2024/2024-04-25-switch_environment_files_in_build_process_for_cordova/img.webp alt width=1024 height=1024></figure><header class=entry-header><h2>cordova build 時に GoogleService-Info.plist, google-services.json を自動切替する</h2></header><div class=entry-content><p>はじめに cordova プロジェクト(monaca)でFCMを使う際、開発環境と本番環境で GoogleService-Info.plist, google-services.json を自動で切り替えたい 正確には google-services.json は複数環境入れるが、今回は必要であった
問題 以下ファイルを用意した、ビルド時に自動で切り替えたい 正確には _dev, _prd の無いファイルを作成したい
google-services_dev.json google-services_prd.json GoogleService-Info_dev.plist GoogleService-Info_prd.plist 解決方法 cordova hook でビルド時に自動で切り替える
以下スクリプトを作成したので記載. scripts/before_build に配置する
#!/usr/bin/env -S bash -e script_dir=$(cd "$(dirname "${BASH_SOURCE:-$0}")" && pwd) && readonly script_dir project_root=$(cd "${script_dir}/.." && pwd) && readonly project_root config_file="${project_root}/config.xml" && readonly config_file get_stage() { grep 'name="STAGE"' "$config_file" | sed -E 's/.*value="([^"]*)".*/\1/' } update_firebase_config() { local append=_prd if [[ $stage == "dev" ]]; then append=_dev fi echo "===> Updating firebase config files" 1>&amp;2 cp -fv "$project_root"/GoogleService-Info${append}....</p></div><footer class=entry-footer><span title='2024-04-25 11:11:47 +0900 +0900'><i class='fa-solid fa-pen'></i> 2024-04-25</span>&nbsp;·&nbsp;<span title='2024-04-25 11:57:40 +0900 +0900'><i class='fa-solid fa-rotate-right'></i> 2024-04-25</span>&nbsp;·&nbsp;1 分&nbsp;·&nbsp;121 文字</footer><a class=entry-link aria-label="post link to cordova build 時に GoogleService-Info.plist, google-services.json を自動切替する" href=https://tro3373.github.io/posts/2024/2024-04-25-switch_environment_files_in_build_process_for_cordova/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://tro3373.github.io/categories/tech/page/4/>«&nbsp;前へ&nbsp;</a>
<a class=next href=https://tro3373.github.io/categories/tech/page/6/>次へ&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2026 <a href=https://tro3373.github.io/>tac lifelog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>